
# 패킹 알고리즘 명세서 (v2.0)

> **문서 개요**: 따사룸 발주 시스템의 자동 포장 방식 결정 및 합포장 최적화 로직 정의
> **기준 데이터**: 2024년 12월 확정된 제품 규격표 기반

---

## 1. 알고리즘 핵심 원칙

### 1.1 기본 포장 우선순위
시스템은 주문 건에 대해 다음 순서로 포장 방식을 시도하여 결정한다.
1. **합포장 (Combined Packing)**: 동일 수취인의 주문을 최대한 하나로 묶음
2. **소박스 (S-Box)**: 가장 효율적인 기본 포장
3. **대박스 (L-Box)**: 소박스 용량을 초과할 경우 선택
4. **강화비닐 (Vinyl)**: 대박스 용량조차 초과하는 고중량/장대 화물일 경우 선택

### 1.2 제품군별 처리 방식 구분
* **롤매트**: `두께(T)`에 따른 `총 길이(m)` 합산을 기준으로 용기 결정
* **퍼즐매트**: `두께(mm)`에 따른 `장수(Count)`를 기준으로 박스 개수 산출

---

## 2. 상세 패킹 로직 (Decision Logic)

### 2.1 롤매트 (Roll Mat) 알고리즘

> **입력값**: 주문 리스트 (두께, 폭, 길이 수량)
> **변수**: `Total_Length` (동일 두께/폭 제품의 길이 합계)

**[처리 프로세스]**
1.  **그룹화**: 동일 수취인 + 동일 제품(두께)으로 그룹화
2.  **길이 합산**: 그룹 내 모든 롤의 길이를 더함 (`Total_Length`)
3.  **용기 매칭**: `Total_Length`를 아래 **[참조표 1]**에 대입하여 결정

**[참조표 1: 롤매트 두께별 포장 임계값]**

| 두께 | 소박스(S) 허용 범위 | 대박스(L) 허용 범위 | 비닐 포장 전환점 |
| :---: | :--- | :--- | :--- |
| **6T** | 0.5m ~ 8m | 8.5m ~ 12m | 12.5m 이상 |
| **9T** | 0.5m ~ 6m | 6.5m ~ 10m | 10.5m 이상 |
| **12T** | 0.5m ~ 3.5m | 4m ~ 8m | 8.5m 이상 |
| **14T** | 0.5m ~ 3m | 3.5m ~ 7m | 7.5m 이상 |
| **18T** | 0.5m ~ 2m | 2.5m ~ 5m | 5.5m 이상 |
| **23T** | 0.5m ~ 1m | 1.5m ~ 3m | 3.5m 이상 |



> **예시 시나리오:**
> * 주문: 110cm/14T/2m × 2개 (총 4m)
> * 판단: 14T 기준, 4m는 소박스(3m) 초과, 대박스(7m) 이내
> * **결과**: **110cm 대박스 1개** (합포장)

---

### 2.2 퍼즐매트 (Puzzle Mat) 알고리즘

> **입력값**: 주문 리스트 (두께, 수량)
> **변수**: `Total_Count` (총 장수)

**[처리 프로세스]**
1.  **그룹화**: 동일 수취인 + 동일 제품(두께)으로 그룹화
2.  **박스 산출**: `Total_Count`를 **[참조표 2]**의 `Max_Capacity`로 나눔
    * `박스 수` = `Ceil(Total_Count / Max_Capacity)`

**[참조표 2: 퍼즐매트 박스 용량]**

| 두께 | 박스당 최대 포장 수량 (`Max_Capacity`) |
| :---: | :--- |
| **25mm** | **6장** |
| **40mm** | **4장** |

> **예시 시나리오:**
> * 주문: 25mm 퍼즐매트 14장
> * 계산: 14 / 6 = 2.33...
> * **결과**: **3박스** (6장 박스 + 6장 박스 + 2장 박스)

---

## 3. 합포장(Bundling) 최적화 규칙

### 3.1 합포장 기본 조건
1.  **수취인 정보 일치**: 이름, 주소, 전화번호가 동일해야 함.
2.  **이종 상품 분리**: 롤매트와 퍼즐매트는 합포장 하지 않음 (별도 송장 원칙).

### 3.2 롤매트 합포장 심화 로직
* **동일 두께 합포장**:
    * 원칙적으로 길이를 단순 합산하여 박스 규격을 결정함.
* **상이 두께 합포장 (Advanced)**:
    * *개발 난이도가 높으나 최적화를 위해 필요한 로직*
    * 부피 환산 방식 사용: 얇은 매트와 두꺼운 매트가 섞일 경우, 두꺼운 매트 기준으로 환산하여 박스 용량 체크.
    * *(현재 단계에서는 '동일 두께끼리만 합포장'을 우선 구현 권장)*
* **폭이 다른 경우**:
    * 가장 넓은 폭의 박스를 사용.
    * 예: `110cm 롤` + `140cm 롤` 합포장 시 → **140cm 박스** 사용.

### 3.3 예외 처리 (강제 분할)
* **택배사 규격 초과**: 합포장 결과물이 택배사 집하 금지 규격(예: 세 변의 합 160cm 초과, 무게 20kg 초과 등)을 넘을 경우, 알고리즘은 강제로 주문을 분할(Split)해야 함.
    * *현재 로직*: `대박스` 기준을 넘으면 `강화비닐`로 넘기되, 비닐 포장도 너무 거대해지면 분리 발송 고려 필요.

---

## 4. 사은품 지급 알고리즘

**트리거**: `최종 결제 금액` (배송비 제외)

| 조건 | 지급 품목 | 로직 |
| :--- | :--- | :--- |
| **200,000원 이상** | **실리콘 테이프** | 주문 리스트에 '실리콘 테이프(증정)' 항목 자동 추가 |
| **300,000원 이상** | **발매트** | 주문 리스트 또는 비고란에 '발매트(증정)' 표기 |

---

## 5. 데이터 파싱 키워드 (Re-defined)

시스템이 주문서를 읽을 때 감지해야 할 핵심 단어들입니다.

### 5.1 재단(Cutting) 요청 감지
`배송메세지` 컬럼에서 아래 단어가 포함되면 **[재단주의]** 플래그를 띄운다.
> `재단`, `컷팅`, `절단`, `잘라`, `길이조절`, `cm`, `mm`

### 5.2 제품 옵션 파싱 (정규표현식 활용 권장)
옵션 텍스트에서 숫자만 추출하여 규격화한다.
* **두께**: `6T`, `6mm`, `0.6cm` → `6`
* **폭**: `110`, `110cm` → `110`
* **길이**: `1m`, `100cm`, `10개(10cm단위 판매시)` → `100` (cm단위 통일)

---

**[작성자 메모]**
* 기존 문서에 있던 `?` 표시된 모호한 규격들은 위 **[참조표 1, 2]**의 확정 데이터로 대체되었습니다.
* 코드는 이제 "100cm 이상이면 비닐"이라는 단순 로직을 버리고, 위 **두께별 임계값 테이블을 참조(Lookup)**하는 방식으로 변경되어야 합니다.
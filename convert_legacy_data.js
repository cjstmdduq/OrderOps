const fs = require('fs');

// 구버전 데이터 (사용자가 제공한 텍스트)
const legacyData = `상품번호	최종옵션명	디자인	길이
282153807	디자인: 로지 / 벽지종류: 두께10mm / 폭1m (고급형) / 길이(수량추가): +2.5m	10T벽지:로지	2.5
282153807	디자인: 로지 / 벽지종류: 두께5mm / 폭1m (일반형) / 길이(수량추가): +2.5m	5T벽지:로지	2.5
282153807	디자인: 스폿그레이 / 벽지종류: 두께10mm / 폭1m (고급형) / 길이(수량추가): +2.5m	10T벽지:스폿그레이	2.5
282153807	디자인: 스폿그레이 / 벽지종류: 두께5mm / 폭1m (일반형) / 길이(수량추가): +2.5m	5T벽지:스폿그레이	2.5
282153807	디자인: 스폿화이트 / 벽지종류: 두께10mm / 폭1m (고급형) / 길이(수량추가): +2.5m	10T벽지: 스폿화이트	2.5
282153807	디자인: 스폿화이트 / 벽지종류: 두께5mm / 폭1m (일반형) / 길이(수량추가): +2.5m	5T벽지:스폿화이트	2.5
282153807	디자인: 오트밀 / 벽지종류: 두께10mm / 폭1m (고급형) / 길이(수량추가): +2.5m	벽지 10T 오트밀	2.5
282153807	디자인: 오트밀 / 벽지종류: 두께5mm / 폭1m (일반형) / 길이(수량추가): +2.5m	벽지 5T 오트밀	2.5
2402587673	디자인: 더블우드 / 사이즈: L [200x140 12T]	더블우드 L [200x140 12T]	L
2402587673	디자인: 더블우드 / 사이즈: S [180x70 12T]	더블우드 S [180x70 12T]	S
2402587673	디자인: 더블우드 / 사이즈: XL [240x140 12T]	더블우드 XL [240x140 12T]	XL
2402587673	디자인: 젤라빈 / 사이즈: L [200x140 12T]	젤라빈 L [200x140 12T]	L
2402587673	디자인: 젤라빈 / 사이즈: S [180x70 12T]	젤라빈 S [180x70 12T]	S
2402587673	디자인: 젤라빈 / 사이즈: XL [240x140 12T]	젤라빈 XL [240x140 12T]	XL
2402587673	디자인: 패브릭트윈 / 사이즈: L [200x140 12T]	패브릭트윈 L [200x140 12T]	L
2402587673	디자인: 패브릭트윈 / 사이즈: S [180x70 12T]	패브릭트윈 S [180x70 12T]	S
2402587673	디자인: 패브릭트윈 / 사이즈: XL [240x140 12T]	패브릭트윈 XL [240x140 12T]	XL
2402587673	디자인: 포레스티아 / 사이즈: L [200x140 12T]	포레스티아 L [200x140 12T]	L
2402587673	디자인: 포레스티아 / 사이즈: S [180x70 12T]	포레스티아 S [180x70 12T]	S
2402587673	디자인: 포레스티아 / 사이즈: XL [240x140 12T]	포레스티아 XL [240x140 12T]	XL
2402587673	디자인: 헤링본트윈 / 사이즈: L [200x140 12T]	헤링본트윈 L [200x140 12T]	L
2402587673	디자인: 헤링본트윈 / 사이즈: S [180x70 12T]	헤링본트윈 S [180x70 12T]	S
2402587673	디자인: 헤링본트윈 / 사이즈: XL [240x140 12T]	헤링본트윈 XL [240x140 12T]	XL
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 12mm(폭110cm) / 길이(수량추가): 50cm	(110)12T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 12mm(폭120cm) / 길이(수량추가): 50cm	(120)12T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 12mm(폭140cm) / 길이(수량추가): 50cm	(140)12T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 6mm(폭110cm) / 길이(수량추가): 50cm	(110)6T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 6mm(폭120cm) / 길이(수량추가): 50cm	(120)6T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 6mm(폭140cm) / 길이(수량추가): 50cm	(140)6T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 9mm(폭110cm) / 길이(수량추가): 50cm	(110)9T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 9mm(폭120cm) / 길이(수량추가): 50cm	(120)9T그레이캔버스	0.5
4200445704	⚡강세일⚡디자인 선택: 그레이캔버스 / 두께(폭): 9mm(폭140cm) / 길이(수량추가): 50cm	(140)9T그레이캔버스	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 12mm(폭110cm) / 길이(수량추가): 50cm	(110)12T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 12mm(폭120cm) / 길이(수량추가): 50cm	(120)12T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 12mm(폭140cm) / 길이(수량추가): 50cm	(140)12T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 6mm(폭110cm) / 길이(수량추가): 50cm	(110)6T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 6mm(폭120cm) / 길이(수량추가): 50cm	(120)6T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 6mm(폭140cm) / 길이(수량추가): 50cm	(140)6T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 9mm(폭110cm) / 길이(수량추가): 50cm	(110)9T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 9mm(폭120cm) / 길이(수량추가): 50cm	(120)9T도그프린트	0.5
4200445704	⛄홀리데이⛄디자인 선택: 도그프린트 / 두께(폭): 9mm(폭140cm) / 길이(수량추가): 50cm	(140)9T도그프린트	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 6mm(폭110cm) / 길이(수량추가): 50cm	(110)6T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 6mm(폭120cm) / 길이(수량추가): 50cm	(120)6T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 6mm(폭140cm) / 길이(수량추가): 50cm	(140)6T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 9mm(폭110cm) / 길이(수량추가): 50cm	(110)9T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 9mm(폭120cm) / 길이(수량추가): 50cm	(120)9T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 9mm(폭140cm) / 길이(수량추가): 50cm	(140)9T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 12mm(폭110cm) / 길이(수량추가): 50cm	(110)12T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 12mm(폭120cm) / 길이(수량추가): 50cm	(120)12T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 마블아이보리 / 두께(폭): 12mm(폭140cm) / 길이(수량추가): 50cm	(140)12T마블아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 12mm(폭110cm) / 길이(수량추가): 50cm	(110)12T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 12mm(폭120cm) / 길이(수량추가): 50cm	(120)12T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 12mm(폭140cm) / 길이(수량추가): 50cm	(140)12T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 6mm(폭110cm) / 길이(수량추가): 50cm	(110)6T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 6mm(폭120cm) / 길이(수량추가): 50cm	(120)6T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 6mm(폭140cm) / 길이(수량추가): 50cm	(140)6T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 9mm(폭110cm) / 길이(수량추가): 50cm	(110)9T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 9mm(폭120cm) / 길이(수량추가): 50cm	(120)9T비글퍼피	0.5
4200445704	⚡강세일⚡디자인 선택: 비글퍼피 / 두께(폭): 9mm(폭140cm) / 길이(수량추가): 50cm	(140)9T비글퍼피	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 12mm(폭110cm) / 길이(수량추가): 50cm	(110)12T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 12mm(폭120cm) / 길이(수량추가): 50cm	(120)12T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 12mm(폭140cm) / 길이(수량추가): 50cm	(140)12T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 6mm(폭110cm) / 길이(수량추가): 50cm	(110)6T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 6mm(폭120cm) / 길이(수량추가): 50cm	(120)6T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 6mm(폭140cm) / 길이(수량추가): 50cm	(140)6T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 9mm(폭110cm) / 길이(수량추가): 50cm	(110)9T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 9mm(폭120cm) / 길이(수량추가): 50cm	(120)9T소프트그레이	0.5
4200445704	⛄홀리데이⛄디자인 선택: 소프트그레이 / 두께(폭): 9mm(폭140cm) / 길이(수량추가): 50cm	(140)9T소프트그레이	0.5
4200445704	⚡강세일⚡디자인 선택: 퓨어아이보리 / 두께(폭): 6mm(폭110cm) / 길이(수량추가): 50cm	(110)6T퓨어아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 퓨어아이보리 / 두께(폭): 6mm(폭120cm) / 길이(수량추가): 50cm	(120)6T퓨어아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 퓨어아이보리 / 두께(폭): 6mm(폭140cm) / 길이(수량추가): 50cm	(140)6T퓨어아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 퓨어아이보리 / 두께(폭): 9mm(폭110cm) / 길이(수량추가): 50cm	(110)9T퓨어아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 퓨어아이보리 / 두께(폭): 12mm(폭110cm) / 길이(수량추가): 50cm	(110)12T퓨어아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 퓨어아이보리 / 두께(폭): 12mm(폭120cm) / 길이(수량추가): 50cm	(120)12T퓨어아이보리	0.5
4200445704	⚡강세일⚡디자인 선택: 퓨어아이보리 / 두께(폭): 12mm(폭140cm) / 길이(수량추가): 50cm	(140)12T퓨어아이보리	0.5
4670410800	디자인: 더블우드 / 사이즈: [124x46 12T]	더블우드S[150x46 12T]	S
4670410800	디자인: 더블우드 / 사이즈: [150x46 12T]	더블우드S[150x46 12T]	S
4670410800	디자인: 더블우드 / 사이즈: [180x46 12T]	더블우드M[180x46 12T]	M
4670410800	디자인: 더블우드 / 사이즈: [75x46 11T]	더블우드S[150x46 12T]	S
4670410800	디자인: 더블우드 / 사이즈: [95x46 12T]	더블우드S[150x46 12T]	S
4670410800	디자인: 샤이닝스타 / 사이즈: [124x46 12T]	샤이닝스타S[150x46 12T]	S
4670410800	디자인: 샤이닝스타 / 사이즈: [150x46 12T]	샤이닝스타S[150x46 12T]	S
4670410800	디자인: 샤이닝스타 / 사이즈: [180x46 12T]	샤이닝스타M[180x46 12T]	M
4670410800	디자인: 샤이닝스타 / 사이즈: [75x46 11T]	샤이닝스타S[150x46 12T]	S
4670410800	디자인: 샤이닝스타 / 사이즈: [95x46 12T]	샤이닝스타S[150x46 12T]	S
4670410800	디자인: 패브릭트윈 / 사이즈: [124x46 12T]	패브릭트윈S[150x46 12T]	S
4670410800	디자인: 패브릭트윈 / 사이즈: [150x46 12T]	패브릭트윈S[150x46 12T]	S
4670410800	디자인: 패브릭트윈 / 사이즈: [180x46 12T]	패브릭트윈M[180x46 12T]	M
4670410800	디자인: 패브릭트윈 / 사이즈: [75x46 11T]	패브릭트윈S[150x46 12T]	S
4670410800	디자인: 패브릭트윈 / 사이즈: [95x46 12T]	패브릭트윈S[150x46 12T]	S
4670410800	디자인: 포레스티아 / 사이즈: [124x46 12T]	포레스티아S[150x46 12T]	S
4670410800	디자인: 포레스티아 / 사이즈: [150x46 12T]	포레스티아S[150x46 12T]	S
4670410800	디자인: 포레스티아 / 사이즈: [180x46 12T]	포레스티아M[180x46 12T]	M
4670410800	디자인: 포레스티아 / 사이즈: [75x46 11T]	포레스티아S[150x46 12T]	S
4670410800	디자인: 포레스티아 / 사이즈: [95x46 12T]	포레스티아S[150x46 12T]	S
4723369915	길이: 20m	★판매★테이프20m	
4723369915	길이: 50m	★판매★테이프50m	
5569937047	디자인: 베이지코튼 / 두께: 결합형 20mm / 구성: 사이드형	TPU20T 베이지코튼 (사)	
5569937047	디자인: 베이지코튼 / 두께: 결합형 20mm / 구성: 센터형	TPU20T 베이지코튼 (센)	
5569937047	디자인: 베이지코튼 / 두께: 결합형 20mm / 구성: 코너형	TPU20T 베이지코튼 (코)	
5569937047	디자인: 베이지코튼 / 두께: 결합형 23mm / 구성: 사이드형	TPU23T 베이지코튼 (사)	
5569937047	디자인: 베이지코튼 / 두께: 결합형 23mm / 구성: 센터형	TPU23T 베이지코튼 (센)	
5569937047	디자인: 베이지코튼 / 두께: 결합형 23mm / 구성: 코너형	TPU23T 베이지코튼 (코)	
5569937047	디자인: 크림마블 / 두께: 결합형 20mm / 구성: 사이드형	TPU20T 크림마블 사이드	사이드형
5569937047	디자인: 크림마블 / 두께: 결합형 20mm / 구성: 센터형	TPU20T 크림마블 센터	센터형
5569937047	디자인: 크림마블 / 두께: 결합형 20mm / 구성: 코너형	TPU20T 크림마블 코너	코너형
5569937047	디자인: 크림마블 / 두께: 결합형 23mm / 구성: 사이드형	TPU23T 크림마블 사이드	사이드형
5569937047	디자인: 크림마블 / 두께: 결합형 23mm / 구성: 센터형	TPU23T 크림마블 센터	센터형
5569937047	디자인: 크림마블 / 두께: 결합형 23mm / 구성: 코너형	TPU23T 크림마블 코너	코너형
5569937047	디자인: 프렌치바닐라 / 두께: 결합형 20mm / 구성: 사이드형	TPU20T 프렌치바닐라 (사)	
5569937047	디자인: 프렌치바닐라 / 두께: 결합형 20mm / 구성: 센터형	TPU20T 프렌치바닐라 (센)	
5569937047	디자인: 프렌치바닐라 / 두께: 결합형 20mm / 구성: 코너형	TPU20T 프렌치바닐라 (코)	
5569937047	디자인: 프렌치바닐라 / 두께: 결합형 23mm / 구성: 사이드형	TPU23T 프렌치바닐라 (사)	
5569937047	디자인: 프렌치바닐라 / 두께: 결합형 23mm / 구성: 센터형	TPU23T 프렌치바닐라 (센)	
5569937047	디자인: 프렌치바닐라 / 두께: 결합형 23mm / 구성: 코너형	TPU23T 프렌치바닐라 (코)	
5569937047	디자인: 화이트마블 / 두께: 결합형 20mm / 구성: 사이드형	TPU20T 화이트마블 사이드	사이드형
5569937047	디자인: 화이트마블 / 두께: 결합형 20mm / 구성: 센터형	TPU20T 화이트마블 센터	센터형
5569937047	디자인: 화이트마블 / 두께: 결합형 20mm / 구성: 코너형	TPU20T 화이트마블 코너	코너형
5569937047	디자인: 화이트마블 / 두께: 결합형 23mm / 구성: 사이드형	TPU23T 화이트마블 사이드	사이드형
5569937047	디자인: 화이트마블 / 두께: 결합형 23mm / 구성: 센터형	TPU23T 화이트마블 센터	센터형
5569937047	디자인: 화이트마블 / 두께: 결합형 23mm / 구성: 코너형	TPU23T 화이트마블 코너	코너형
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 라이트그레이 / (두께)사이즈: (25mm) 100x100 1장	25T(퍼즐)그레이(100)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 라이트그레이 / (두께)사이즈: (25mm) 50x50 4장	25T(퍼즐)그레이(50)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 바닐라아이보리 / (두께)사이즈: (25mm) 100x100 1장	25T(퍼즐)아이보리(100)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 바닐라아이보리 / (두께)사이즈: (25mm) 50x50 4장	25T(퍼즐)아이보리(50)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 바닐라아이보리 / (두께)사이즈: (40mm) 100x100 1장	40T(퍼즐)아이보리(100)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 바닐라아이보리 / (두께)사이즈: (40mm) 50x50 4장	40T(퍼즐)아이보리(50)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 스카이블루 / (두께)사이즈: (25mm) 100x100 1장	25T(퍼즐)블루(100)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 스카이블루 / (두께)사이즈: (25mm) 50x50 4장	25T(퍼즐)블루(50)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 파스텔핑크 / (두께)사이즈: (25mm) 100x100 1장	25T(퍼즐)핑크(100)	
5994906898	⛄홀리데이⛄제품 타입: 퍼즐매트 / 색상: 파스텔핑크 / (두께)사이즈: (25mm) 50x50 4장	25T(퍼즐)핑크(50)	
5994906898	⛄홀리데이⛄제품 타입: ✨퍼즐매트 PLUS+✨ / 색상: 바닐라아이보리 / (두께)사이즈: (25mm) 100x100 1장	플러스♥25T아이(100)	
5994906898	⛄홀리데이⛄제품 타입: ✨퍼즐매트 PLUS+✨ / 색상: 바닐라아이보리 / (두께)사이즈: (25mm) 50x50 4장	플러스♥25T아이(50)	
5994906898	⛄홀리데이⛄제품 타입: ✨퍼즐매트 PLUS+✨ / 색상: 크림그레이 / (두께)사이즈: (25mm) 100x100 1장	플러스♥25T크림그레이(100)	
5994906898	⛄홀리데이⛄제품 타입: ✨퍼즐매트 PLUS+✨ / 색상: 크림그레이 / (두께)사이즈: (25mm) 50x50 4장	플러스♥25T크림그레이(50)`;

// 색상 축약 규칙 (app.js와 동일)
const COLOR_ABBREVIATIONS = {
  "바닐라아이보리": "아이보리",
  "바닐라 아이보리": "아이보리",
  "라이트그레이": "그레이",
  "라이트 그레이": "그레이",
  "스카이블루": "블루",
  "스카이 블루": "블루",
  "파스텔핑크": "핑크",
  "파스텔 핑크": "핑크",
  "퓨어아이보리": "퓨어",
  "퓨어 아이보리": "퓨어",
  "마블아이보리": "마블",
  "마블 아이보리": "마블",
  "그레이캔버스": "그캔",
  "그레이 캔버스": "그캔",
  "딜라이트우드": "우드",
  "딜라이트 우드": "우드",
  "비글퍼비": "비글",
  "비글 퍼비": "비글",
  "도그프린드": "도그",
  "도그 프린드": "도그",
  "도그프렌드": "도그",
  "소프트그레이": "소그",
  "소프트 그레이": "소그",
  "테리어": "테리",
  "크림아이보리": "크림",
  "크림 아이보리": "크림",
  "소프트아이보리": "소프트",
  "소프트 아이보리": "소프트",
  "모던그레이": "모던그레",
  "스노우화이트": "스노우",
  "내추럴우드": "내추럴",
  "크림그레이": "크림그레이" // 추가
};

// 프로모션 문구 제거
function removePromotions(text) {
  if (!text) return '';
  return text
    .replace(/⚡[^⚡]*⚡/g, '')
    .replace(/⛄[^⛄]*⛄/g, '')
    .replace(/✨[^✨]*✨/g, '')
    .replace(/\[특가\]/g, '')
    .replace(/\[할인\]/g, '')
    .replace(/\[강세일\]/g, '')
    .replace(/\[홀리데이\]/g, '')
    .trim();
}

// 색상명 축약
function shortenColor(colorName) {
  if (!colorName) return '';
  for (const [full, short] of Object.entries(COLOR_ABBREVIATIONS)) {
    if (colorName.includes(full)) {
      return short;
    }
  }
  return colorName.length > 4 ? colorName.substring(0, 4) : colorName;
}

// 디자인 코드 생성 (최신 로직 적용)
function generateDesignCode(productId, optionInfo, legacyDesign) {
  const cleanOption = removePromotions(optionInfo);
  
  // 벽지 (282153807, 561709916)
  if (productId === '282153807' || productId === '561709916') {
    const thicknessMatch = cleanOption.match(/두께(\d+)mm/);
    const designMatch = cleanOption.match(/디자인:\s*([^\/]+)/);
    if (thicknessMatch && designMatch) {
      const thickness = thicknessMatch[1];
      const design = designMatch[1].trim();
      return `${thickness}T벽지:${design}`;
    }
    return legacyDesign || '';
  }
  
  // 접이매트 (2402587673, 4670410800)
  if (productId === '2402587673' || productId === '4670410800') {
    // 구버전 디자인이 이미 올바른 형식이면 그대로 사용
    return legacyDesign || '';
  }
  
  // 애견롤매트 (4200445704)
  if (productId === '4200445704') {
    const widthMatch = cleanOption.match(/폭(\d+)cm/);
    const thicknessMatch = cleanOption.match(/(\d+)mm/);
    const designMatch = cleanOption.match(/디자인[^:]*:\s*([^\s\/]+)/);
    if (widthMatch && thicknessMatch && designMatch) {
      const width = widthMatch[1];
      const thickness = thicknessMatch[1];
      const design = designMatch[1].trim();
      const shortDesign = shortenColor(design);
      return `(${width})${thickness}T${shortDesign}`;
    }
    return legacyDesign || '';
  }
  
  // 테이프 (4723369915)
  if (productId === '4723369915') {
    const lengthMatch = cleanOption.match(/(\d+)m/);
    const length = lengthMatch ? lengthMatch[1] : '20';
    return `★판매★테이프${length}m`;
  }
  
  // TPU (5569937047)
  if (productId === '5569937047') {
    const thicknessMatch = cleanOption.match(/(\d+)mm/);
    const designMatch = cleanOption.match(/디자인:\s*([^\/]+)/);
    const configMatch = cleanOption.match(/구성:\s*([^\/]+)/);
    if (thicknessMatch && designMatch) {
      const thickness = thicknessMatch[1];
      const design = designMatch[1].trim();
      let config = '';
      if (configMatch) {
        const configType = configMatch[1].trim();
        if (configType === '사이드형') config = ' (사)';
        else if (configType === '센터형') config = ' (센)';
        else if (configType === '코너형') config = ' (코)';
        else if (configType.includes('사이드')) config = ' 사이드';
        else if (configType.includes('센터')) config = ' 센터';
        else if (configType.includes('코너')) config = ' 코너';
      }
      return `TPU${thickness}T ${design}${config}`;
    }
    return legacyDesign || '';
  }
  
  // 퍼즐매트 (5994906898, 5994903887)
  if (productId === '5994906898' || productId === '5994903887') {
    // 플러스 감지는 프로모션 제거 전에 수행
    const isPlus = optionInfo.includes('PLUS+') || optionInfo.includes('플러스');
    const thicknessMatch = cleanOption.match(/\((\d+)mm\)/);
    const colorMatch = cleanOption.match(/색상:\s*([^\/]+)/);
    const sizeMatch = cleanOption.match(/(\d+)x(\d+)/);
    
    if (thicknessMatch && colorMatch) {
      const thickness = thicknessMatch[1];
      const color = colorMatch[1].trim();
      const shortColor = shortenColor(color);
      let size = '100';
      if (sizeMatch) {
        const size1 = parseInt(sizeMatch[1]);
        const size2 = parseInt(sizeMatch[2]);
        if (size1 === 50 || size2 === 50) size = '50';
      }
      
      if (isPlus) {
        // 플러스 제품은 색상을 더 짧게 축약 (구버전 데이터 형식)
        let plusColor = shortColor;
        if (color.includes('바닐라아이보리') || color.includes('바닐라 아이보리')) {
          plusColor = '아이';
        } else if (color.includes('크림그레이')) {
          plusColor = '크림그레이'; // 그대로 유지
        }
        return `플러스(PLUS)${thickness}T${plusColor}(${size})`;
      }
      return `${thickness}T(퍼즐)${shortColor}(${size})`;
    }
    return legacyDesign || '';
  }
  
  return legacyDesign || '';
}

// 메인 변환 로직
function convertLegacyData() {
  const lines = legacyData.split('\n').filter(line => line.trim());
  const header = lines[0];
  const dataLines = lines.slice(1);
  
  const results = [];
  
  for (const line of dataLines) {
    const parts = line.split('\t');
    if (parts.length < 4) continue;
    
    const productId = parts[0].trim();
    const optionInfo = parts[1].trim();
    const legacyDesign = parts[2].trim();
    const length = parts[3].trim();
    
    // 최신 디자인 코드 생성
    const newDesignCode = generateDesignCode(productId, optionInfo, legacyDesign);
    
    results.push({
      productId,
      optionInfo: removePromotions(optionInfo), // 프로모션 제거된 옵션정보
      designCode: newDesignCode,
      length: length || ''
    });
  }
  
  return results;
}

// CSV 생성
function generateCSV(results) {
  const headers = ['상품번호', '옵션정보', '디자인코드', '길이'];
  const rows = [headers.join(',')];
  
  for (const result of results) {
    const row = [
      result.productId,
      `"${result.optionInfo.replace(/"/g, '""')}"`, // CSV 이스케이프
      `"${result.designCode.replace(/"/g, '""')}"`,
      result.length
    ];
    rows.push(row.join(','));
  }
  
  return rows.join('\n');
}

// 실행
const results = convertLegacyData();
const csv = generateCSV(results);

// 파일 저장
fs.writeFileSync('product_design_codes.csv', csv, 'utf-8');
console.log('✅ 변환 완료! product_design_codes.csv 파일이 생성되었습니다.');
console.log(`총 ${results.length}개 항목이 변환되었습니다.`);

// 샘플 출력
console.log('\n=== 샘플 데이터 (처음 10개) ===');
results.slice(0, 10).forEach((r, i) => {
  console.log(`${i + 1}. [${r.productId}] ${r.designCode}`);
});


